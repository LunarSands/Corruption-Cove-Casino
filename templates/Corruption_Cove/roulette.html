{% extends 'Corruption_Cove/base.html' %}
{% load static %}

{% block title_block %}
Roulette
{% endblock %}
    
{% block body_block %}
<link rel="stylesheet" type="text/css" href= "{% static 'roulette.css' %}">

    {% include 'Corruption_Cove/bets.html' %}

    <div class="roulette_images">
        <img class="base_roulette" src="{% static '/images/base_roulette.png' %}" alt="" width="384" height="384">
        <div class="wheel_roulette">
            <img src="{% static '/images/wheel_roulette.png' %}" alt="" width="384" height="384">
            <img class="ball_roulette" src="{% static '/images/ball_roulette.png' %}" alt="" width="384" height="384">
        </div>
    </div>

    <div class="controls">
        <div class="grid-container">
            {% for bet_type,bet_name in bet_types %}
            <div onclick="addBetValue('{{bet_type}}')" class="{{bet_type}}">{{bet_name}}</div>
            {% endfor %}
        </div>
        <button onclick="checkBet()">Check Bets</button>
        <button onclick="clearBet()">Clear Bets</button>
        <button onclick="startBall()">Start Ball</button>
        <button data-href="{% url 'corruption-cove-casino:howToPlay' gameType='roulette' %}" onclick="window.open(this.dataset.href, 'how-to-play', 'width=600,height=400,toolbar=no,scrollbars=yes,resizable=yes'); return false;">
            How to play roulette?
        </button>
    </div>

    <script>
        var moneyBet = 0;
        const currentBets = new Map();
        var request = {}
        const resultMap = new Map();
        const oddsBet = new Map();
        const betTypes = [
            "bet-0", "bet-1", "bet-2", "bet-3", "bet-4", "bet-5", "bet-6", "bet-7", "bet-8", "bet-9", 
            "bet-10", "bet-11", "bet-12", "bet-13", "bet-14", "bet-15", "bet-16", "bet-17", "bet-18", "bet-19", 
            "bet-20", "bet-21", "bet-22", "bet-23", "bet-24", "bet-25", "bet-26", "bet-27", "bet-28", "bet-29", 
            "bet-30", "bet-31", "bet-32", "bet-33", "bet-34", "bet-35", "bet-36", "bet-row1", "bet-row2", "bet-row3", 
            "bet-1st", "bet-2nd", "bet-3rd", "bet-low", "bet-even", "bet-red", "bet-black", "bet-odd", "bet-high"
        ];
        const red = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
        const order = [0, 26, 3, 35, 12, 28, 7, 29, 18, 22, 9, 31, 14, 20, 1, 33, 16, 24, 5, 10, 23, 8, 30, 11, 36, 13, 27, 6, 34, 17, 25, 2, 21, 4, 19, 15, 32]
        for (let i = 0; i < order.length; i++) {
            resultMap.set(i, order[i]);
        }

        for (let i = 0; i < betTypes.length; i++) {
            currentBets.set(betTypes[i], 0);
        }

        for (let i = 1; i < 37; i++){
            if (red.includes(i)){
                document.getElementsByClassName("bet-" + i)[0].style["background-color"] = "rgb(174, 13, 13)";
            }
            else {
                document.getElementsByClassName("bet-" + i)[0].style["background-color"] = "black";
            }
        }
        document.getElementsByClassName("bet-red")[0].style["background-color"] = "rgb(174, 13, 13)";
        document.getElementsByClassName("bet-black")[0].style["background-color"] = "black";

        function addBetValue(bet) {
            currentBets.set(bet, currentBets.get(bet)+100)
            moneyBet += 100;
            request[bet] = currentBets.get(bet);
        }

        function checkBet() {
            let outputText = "";
            for (let i = 0; i < betTypes.length; i++) {
                if (currentBets.get(betTypes[i]) != 0){
                    outputText = outputText.concat("You bet ", currentBets.get(betTypes[i]), " on ", betTypes[i], "\n");
                }
            }
            alert(outputText);
        }
        function clearBet() {
            for (let i = 0; i < betTypes.length; i++) {
                currentBets.set(betTypes[i], 0)
            }
            moneyBet = 0;
            request = {}
            alert('Bets Cleared');
        }

        function startBall(){
            $.get("{% url 'corruption-cove-casino:play_roulette' %}", request, function(output) {
                let message = "Your winnings: ";
                let generated = output.split(":")[0];
                let winnings = output.split(":")[1];
                message = message.concat(winnings);
                message = message.concat("\nYour losses: -");
                message = message.concat(moneyBet);
                document.getElementsByClassName("ball_roulette")[0].style["display"] = "inline";
                document.getElementsByClassName("ball_roulette")[0].style["animation-iteration-count"] = generated/37 + 3;
                document.getElementsByClassName("ball_roulette")[0].style["animation-play-state"] = "running";
                setTimeout(function(){
                    document.getElementsByClassName("ball_roulette")[0].src = "{% static '/images/ball_roulette_alt.png' %}";
                    setTimeout(function() {
                        alert(message);
                        location.reload();
                    }, 1000)
                }, (generated/37 + 3) * 2000)
            })
        }
    </script>
{% endblock %}